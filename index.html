<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í–‰ë³µì€í–‰ ATM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --primary-color: #0046ff; --bg-color: #f4f7fa; }
        body { font-family: 'Pretendard', -apple-system, sans-serif; background-color: #333; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        .phone-frame { width: 360px; height: 740px; background: white; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); overflow: hidden; position: relative; display: flex; flex-direction: column; border: 8px solid #222; }
        
        .screen { flex: 1; display: none; flex-direction: column; padding: 25px; box-sizing: border-box; }
        .screen.active { display: flex; }

        /* ì„¤ì • í™”ë©´ */
        .setup-screen { overflow-y: auto; }
        .setup-screen h2 { font-size: 1.2rem; color: var(--primary-color); margin-top: 0; }
        .setup-screen input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 0.9rem; }
        .start-btn { background: #222; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; margin-top: 10px; font-weight: bold; }

        /* í—¤ë” */
        .header { background: var(--primary-color); color: white; padding: 20px; text-align: center; font-weight: bold; margin: -25px -25px 20px -25px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* ë©”ì¸ í™”ë©´ */
        .main-content { text-align: center; justify-content: center; flex: 1; display: flex; flex-direction: column; }
        .withdraw-btn { background: var(--primary-color); color: white; border: none; width: 160px; height: 160px; border-radius: 50%; font-size: 1.3rem; font-weight: bold; cursor: pointer; margin: 0 auto; box-shadow: 0 10px 25px rgba(0,70,255,0.4); transition: 0.2s; }
        .withdraw-btn:active { transform: scale(0.9); }

        /* í‚¤íŒ¨ë“œ */
        .pw-display { font-size: 2.5rem; letter-spacing: 15px; height: 50px; margin-bottom: 20px; text-align: center; color: var(--primary-color); }
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .key { background: #f8f9fa; padding: 20px; border-radius: 15px; text-align: center; font-size: 1.4rem; cursor: pointer; font-weight: bold; border: 1px solid #eee; }
        .key:active { background: #e2e6ea; }

        /* ì˜ìˆ˜ì¦/QR ê²°ê³¼ */
        #receipt { background: white; border: 1px solid #ddd; padding: 20px; border-top: 10px dashed var(--primary-color); text-align: center; }
        .receipt-info { text-align: left; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .receipt-info p { margin: 5px 0; font-size: 0.9rem; }
        #qrcode { display: flex; justify-content: center; margin: 20px 0; }
        #qrcode img { border: 4px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        
        .loading-text { font-weight: bold; color: var(--primary-color); font-size: 1.5rem; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="phone-frame">
        <div id="screen-setup" class="screen active setup-screen">
            <h2>âš™ï¸ íš¨ë„ ATM ì‚¬ì „ ì„¤ì •</h2>
            <input type="text" id="parent-name" placeholder="ë¶€ëª¨ë‹˜ ì„±í•¨ (ì˜ˆ: ì´ì˜í¬ ê³ ê°ë‹˜)">
            <input type="text" id="coupon-name" placeholder="ì¿ í°ëª… (ì˜ˆ: ë¬´ì œí•œ ì•ˆë§ˆê¶Œ)">
            <input type="text" id="coupon-msg" placeholder="ë¶€ëª¨ë‹˜ê»˜ ì „í•˜ëŠ” ë©”ì‹œì§€">
            <input type="text" id="coupon-url" placeholder="ì—°ê²°í•  URL (ì˜ˆ: https://...)">
            <button class="start-btn" onclick="goToMain()">ì´ë²¤íŠ¸ ì‹œì‘í•˜ê¸°</button>
        </div>

        <div id="screen-main" class="screen">
            <div class="header">ğŸ›ï¸ íš¨ë„ì€í–‰ (Hyo-do Bank)</div>
            <div class="main-content">
                <h3 id="display-name" style="font-size: 1.5rem;">ê³ ê°ë‹˜</h3>
                <p style="color: #666;">ë³¸ì¸ ì¸ì¦ í›„ ì„ ë¬¼ì„ ì¸ì¶œí•˜ì„¸ìš”.</p>
                <div style="height: 50px;"></div>
                <button class="withdraw-btn" onclick="goToPassword()">ì¸ì¶œ ì‹œì‘</button>
            </div>
        </div>

        <div id="screen-pw" class="screen">
            <div class="header">ë³´ì•ˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</div>
            <div class="main-content">
                <div class="pw-display" id="pw-dots"></div>
                <div class="keypad">
                    <script>
                        for(let i=1; i<=9; i++) document.write(`<div class="key" onclick="pressKey('${i}')">${i}</div>`);
                    </script>
                    <div class="key" style="background:none; border:none;"></div>
                    <div class="key" onclick="pressKey('0')">0</div>
                    <div class="key" onclick="resetPw()" style="color: red;">C</div>
                </div>
            </div>
        </div>

        <div id="screen-loading" class="screen">
            <div class="main-content">
                <div class="loading-text">ğŸ’° í˜„ê¸ˆì„ ì„¸ëŠ” ì¤‘...</div>
                <p>ì‚¬ë‘ì„ ê°€ë“ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <div id="screen-result" class="screen">
            <div class="header">ì¶œê¸ˆ ì™„ë£Œ</div>
            <div class="main-content" style="justify-content: flex-start;">
                <div id="receipt">
                    <div class="receipt-info">
                        <p><b>ì¿ í°:</b> <span id="res-coupon"></span></p>
                        <p><b>ìˆ˜ë ¹:</b> <span id="res-name"></span></p>
                        <p style="margin-top:10px; color:#0046ff; font-weight:bold;" id="res-msg"></p>
                    </div>
                    <div id="qrcode"></div>
                    <p style="font-size: 0.75rem; color: #888;">QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì—¬ ì„ ë¬¼ì„ í™•ì¸í•˜ì„¸ìš”!</p>
                </div>
                <button class="start-btn" onclick="location.reload()" style="background:#eee; color:#333; margin-top:20px;">ì‹œìŠ¤í…œ ì¢…ë£Œ</button>
            </div>
        </div>
    </div>

    <script>
        // ì†Œë¦¬ ì¬ìƒìš© ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playBeep(freq, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function goToMain() {
            if(!document.getElementById('parent-name').value) return alert("ì„±í•¨ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
            document.getElementById('display-name').innerText = document.getElementById('parent-name').value + " ê³ ê°ë‹˜";
            showScreen('screen-main');
        }

        function goToPassword() {
            playBeep(880, 0.1);
            showScreen('screen-pw');
        }

        let pw = "";
        function pressKey(num) {
            if(pw.length < 4) {
                pw += num;
                document.getElementById('pw-dots').innerText = "â— ".repeat(pw.length);
                playBeep(1000, 0.1);
            }
            if(pw.length === 4) {
                setTimeout(processWithdraw, 400);
            }
        }

        function resetPw() { pw = ""; document.getElementById('pw-dots').innerText = ""; playBeep(440, 0.1); }

        function processWithdraw() {
            showScreen('screen-loading');
            
            // ëˆ ì„¸ëŠ” ì†Œë¦¬ (ì—°ì† ë¹„í”„ìŒ)
            let count = 0;
            const moneySound = setInterval(() => {
                playBeep(200 + (count * 100), 0.05);
                if(count++ > 15) clearInterval(moneySound);
            }, 100);

            // ë°ì´í„° ì„¸íŒ…
            const url = document.getElementById('coupon-url').value || "https://tistory.com";
            document.getElementById('res-name').innerText = document.getElementById('parent-name').value;
            document.getElementById('res-coupon').innerText = document.getElementById('coupon-name').value;
            document.getElementById('res-msg').innerText = `"${document.getElementById('coupon-msg').value}"`;

            // QR ì½”ë“œ ìƒì„±
            document.getElementById('qrcode').innerHTML = ""; // ì´ˆê¸°í™”
            new QRCode(document.getElementById("qrcode"), {
                text: url,
                width: 150,
                height: 150,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });

            setTimeout(() => {
                showScreen('screen-result');
                playBeep(1200, 0.3);
            }, 3000);
        }
    </script>
</body>
</html>
