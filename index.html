<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í–‰ë³µì€í–‰ ATM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --primary-color: #ff477e; --bg-color: #fff0f5; } /* í–‰ë³µì€í–‰ì€ ë”°ëœ»í•œ í•‘í¬/ë ˆë“œí†¤ */
        body { font-family: 'Pretendard', sans-serif; background-color: #222; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        .phone-frame { width: 360px; height: 760px; background: white; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); overflow: hidden; position: relative; display: flex; flex-direction: column; border: 8px solid #333; }
        
        .screen { flex: 1; display: none; flex-direction: column; padding: 25px; box-sizing: border-box; overflow-y: auto; }
        .screen.active { display: flex; }

        /* ì„¤ì • í™”ë©´ */
        .setup-screen h2 { font-size: 1.3rem; color: var(--primary-color); margin-top: 0; text-align: center; }
        .setup-group { margin-bottom: 15px; background: #f9f9f9; padding: 10px; border-radius: 10px; }
        .setup-group label { display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: #555; }
        .setup-screen input, .setup-screen select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 0.9rem; }
        .start-btn { background: var(--primary-color); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem; }

        /* í—¤ë” */
        .header { background: var(--primary-color); color: white; padding: 20px; text-align: center; font-weight: bold; margin: -25px -25px 20px -25px; font-size: 1.2rem; }
        
        /* ë©”ì¸ í™”ë©´ */
        .main-content { text-align: center; justify-content: center; flex: 1; display: flex; flex-direction: column; }
        .withdraw-btn { background: var(--primary-color); color: white; border: none; width: 160px; height: 160px; border-radius: 50%; font-size: 1.4rem; font-weight: bold; cursor: pointer; margin: 0 auto; box-shadow: 0 10px 25px rgba(255,71,126,0.4); transition: 0.2s; }

        /* í‚¤íŒ¨ë“œ */
        .pw-display { font-size: 2.5rem; letter-spacing: 15px; height: 50px; margin-bottom: 20px; text-align: center; color: var(--primary-color); }
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .key { background: #fdf2f5; padding: 18px; border-radius: 15px; text-align: center; font-size: 1.4rem; cursor: pointer; font-weight: bold; border: 1px solid #fee; }

        /* ì˜ìˆ˜ì¦ ê²°ê³¼ */
        #receipt { background: white; border: 1px solid #ddd; padding: 20px; border-top: 10px dashed var(--primary-color); text-align: center; }
        .barcode { width: 100%; height: 60px; background: repeating-linear-gradient(90deg, #000 0, #000 2px, #fff 2px, #fff 5px); margin: 20px 0; }
        #qrcode { display: flex; justify-content: center; margin: 20px 0; }
        
        .loading-text { font-weight: bold; color: var(--primary-color); font-size: 1.5rem; }
    </style>
</head>
<body>

    <div class="phone-frame">
        <div id="screen-setup" class="screen active setup-screen">
            <h2>ğŸ¦ í–‰ë³µì€í–‰ ì‹œìŠ¤í…œ ì„¤ì •</h2>
            <div class="setup-group">
                <label>ë¶€ëª¨ë‹˜ ì„±í•¨</label>
                <input type="text" id="parent-name" placeholder="ì˜ˆ: ê¹€í–‰ë³µ ê³ ê°ë‹˜">
            </div>
            <div class="setup-group">
                <label>ì¿ í° ì •ë³´</label>
                <input type="text" id="coupon-name" placeholder="ì˜ˆ: ë¬´ì œí•œ ì•ˆë§ˆê¶Œ">
                <input type="text" id="coupon-val" placeholder="ì½”ë“œë²ˆí˜¸ ë˜ëŠ” URL ì…ë ¥" style="margin-top:5px;">
            </div>
            <div class="setup-group">
                <label>ì¸ì¶œ í˜•íƒœ ì„ íƒ</label>
                <select id="output-type">
                    <option value="qr">QR ì½”ë“œ (URL ì—°ê²°ì— ì¶”ì²œ)</option>
                    <option value="barcode">ë°”ì½”ë“œ (ì˜ìˆ˜ì¦ ëŠë‚Œì— ì¶”ì²œ)</option>
                </select>
            </div>
            <div class="setup-group">
                <label>ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</label>
                <select id="pw-mode" onchange="togglePwInput()">
                    <option value="any">ì•„ë¬´ ë²ˆí˜¸ë‚˜ ëˆŒëŸ¬ë„ í†µê³¼</option>
                    <option value="real">ì§€ì •í•œ ë²ˆí˜¸ë§Œ í†µê³¼</option>
                </select>
                <input type="password" id="pw-val" placeholder="ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬" maxlength="4" style="margin-top:5px; display:none;">
            </div>
            <button class="start-btn" onclick="goToMain()">ATM ì‹œìŠ¤í…œ ê°€ë™</button>
        </div>

        <div id="screen-main" class="screen">
            <div class="header">ğŸ¦ í–‰ë³µì€í–‰ (Happiness Bank)</div>
            <div class="main-content">
                <h3 id="display-name" style="font-size: 1.5rem;">ê³ ê°ë‹˜</h3>
                <p style="color: #888;">í–‰ë³µí•œ í•˜ë£¨ ë˜ì„¸ìš”!<br>ì„ ë¬¼ ì¸ì¶œì„ ìœ„í•´ ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
                <div style="height: 40px;"></div>
                <button class="withdraw-btn" onclick="goToPassword()">ì¸ì¶œí•˜ê¸°</button>
            </div>
        </div>

        <div id="screen-pw" class="screen">
            <div class="header">ë³´ì•ˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</div>
            <div class="main-content">
                <div class="pw-display" id="pw-dots"></div>
                <div class="keypad">
                    <script>
                        for(let i=1; i<=9; i++) document.write(`<div class="key" onclick="pressKey('${i}')">${i}</div>`);
                    </script>
                    <div class="key" style="visibility:hidden"></div>
                    <div class="key" onclick="pressKey('0')">0</div>
                    <div class="key" onclick="resetPw()" style="color: #ff477e;">C</div>
                </div>
            </div>
        </div>

        <div id="screen-loading" class="screen">
            <div class="main-content">
                <div class="loading-text">ğŸ’– í–‰ë³µì„ ì¸ì¶œ ì¤‘...</div>
                <p>ì‚¬ë‘ê³¼ ì •ì„±ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <div id="screen-result" class="screen">
            <div class="header">ì¸ì¶œ ì„±ê³µ</div>
            <div class="main-content" style="justify-content: flex-start;">
                <div id="receipt">
                    <div style="font-weight:bold; border-bottom:2px solid var(--primary-color); padding-bottom:10px; margin-bottom:15px;">í–‰ë³µ ì˜ìˆ˜ì¦</div>
                    <p style="text-align:left; font-size:0.9rem;"><b>í•­ëª©:</b> <span id="res-coupon"></span></p>
                    <p style="text-align:left; font-size:0.9rem;"><b>ê³ ê°:</b> <span id="res-name"></span></p>
                    
                    <div id="output-area">
                        <div id="qrcode" style="display:none;"></div>
                        <div id="barcode" class="barcode" style="display:none;"></div>
                        <div id="res-code-text" style="font-family:monospace; font-weight:bold;"></div>
                    </div>
                    
                    <p style="font-size: 0.75rem; color: #888; margin-top:15px;">í•­ìƒ ë‹¹ì‹ ì˜ í–‰ë³µì„ ì‘ì›í•©ë‹ˆë‹¤.</p>
                </div>
                <button class="start-btn" onclick="location.reload()" style="background:#f4f4f4; color:#666; margin-top:20px;">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playBeep(freq, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.start(); osc.stop(audioCtx.currentTime + duration);
        }

        function togglePwInput() {
            const mode = document.getElementById('pw-mode').value;
            document.getElementById('pw-val').style.display = (mode === 'real') ? 'block' : 'none';
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function goToMain() {
            const name = document.getElementById('parent-name').value;
            if(!name) return alert("ë¶€ëª¨ë‹˜ ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            document.getElementById('display-name').innerText = name + " ê³ ê°ë‹˜";
            showScreen('screen-main');
        }

        function goToPassword() {
            playBeep(880, 0.1);
            showScreen('screen-pw');
        }

        let pwInput = "";
        function pressKey(num) {
            if(pwInput.length < 4) {
                pwInput += num;
                document.getElementById('pw-dots').innerText = "â™¥ ".repeat(pwInput.length);
                playBeep(1000, 0.1);
            }
            if(pwInput.length === 4) {
                const mode = document.getElementById('pw-mode').value;
                const correctPw = document.getElementById('pw-val').value;
                
                if(mode === 'real' && pwInput !== correctPw) {
                    setTimeout(() => {
                        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                        resetPw();
                    }, 200);
                } else {
                    setTimeout(processWithdraw, 400);
                }
            }
        }

        function resetPw() { pwInput = ""; document.getElementById('pw-dots').innerText = ""; playBeep(440, 0.1); }

        function processWithdraw() {
            showScreen('screen-loading');
            let count = 0;
            const soundInterval = setInterval(() => {
                playBeep(300 + (count * 50), 0.05);
                if(count++ > 12) clearInterval(soundInterval);
            }, 100);

            // ë°ì´í„° ì„¸íŒ…
            const name = document.getElementById('parent-name').value;
            const coupon = document.getElementById('coupon-name').value;
            const val = document.getElementById('coupon-val').value || "HAPPY-LUCKY-777";
            const type = document.getElementById('output-type').value;

            document.getElementById('res-name').innerText = name;
            document.getElementById('res-coupon').innerText = coupon;
            document.getElementById('res-code-text').innerText = val;

            // ì¶œë ¥ í˜•íƒœ ì œì–´
            if(type === 'qr') {
                document.getElementById('qrcode').style.display = 'flex';
                document.getElementById('qrcode').innerHTML = "";
                new QRCode(document.getElementById("qrcode"), { text: val, width: 140, height: 140 });
            } else {
                document.getElementById('barcode').style.display = 'block';
            }

            setTimeout(() => {
                showScreen('screen-result');
                playBeep(1200, 0.3);
            }, 3000);
        }
    </script>
</body>
</html>
