<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í–‰ë³µì€í–‰ ATM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --main-blue: #003399; --gold: #d4af37; --bg-light: #f4f7fa; }
        body { font-family: 'Pretendard', sans-serif; background-color: #1a1a1a; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        .phone-frame { width: 360px; height: 780px; background: white; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); overflow: hidden; position: relative; display: flex; flex-direction: column; border: 8px solid #444; }
        
        .screen { flex: 1; display: none; flex-direction: column; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .screen.active { display: flex; }

        .header { background: var(--main-blue); color: white; padding: 18px; text-align: center; font-weight: bold; margin: -20px -20px 20px -20px; border-bottom: 4px solid var(--gold); }
        .primary-btn { background: var(--main-blue); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .withdraw-btn { background: radial-gradient(circle, var(--main-blue), #001a4d); color: white; border: 4px solid var(--gold); width: 160px; height: 160px; border-radius: 50%; font-size: 1.3rem; font-weight: bold; cursor: pointer; margin: 20px auto; box-shadow: 0 8px 20px rgba(0,0,0,0.3); }

        .pw-display { font-size: 2.2rem; letter-spacing: 12px; height: 50px; text-align: center; color: var(--main-blue); }
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .key { background: #f0f3f7; padding: 16px; border-radius: 10px; text-align: center; font-size: 1.3rem; cursor: pointer; font-weight: bold; border-bottom: 3px solid #ccc; }

        /* ëª…ì„¸í‘œ ìŠ¤íƒ€ì¼ */
        #receipt-area { background: #fff; padding: 20px; border-top: 10px dashed var(--main-blue); font-size: 0.9rem; color: #333; }
        .barcode { width: 100%; height: 50px; background: repeating-linear-gradient(90deg, #000 0, #000 2px, #fff 2px, #fff 5px); margin: 15px 0; }
        #qrcode { display: flex; justify-content: center; margin: 15px 0; }
        
        .loading-wheel { border: 4px solid #f3f3f3; border-top: 4px solid var(--main-blue); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* ì„¤ì •ì°½ ìŠ¤íƒ€ì¼ */
        .setup-group { margin-bottom: 10px; }
        .setup-group label { font-size: 0.7rem; color: #666; font-weight: bold; }
        .setup-group input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div class="phone-frame">
        <div id="screen-setup" class="screen active">
            <h2 style="color: var(--main-blue);">ğŸ›ï¸ ì¸ì¶œê¸° ê´€ë¦¬ ì„¤ì •</h2>
            <div class="setup-group"><label>ëŒ€ìƒì ì´ë¦„</label><input type="text" id="set-target" placeholder="ì˜ˆ: ìš°ë¦¬ ì—„ë§ˆ"></div>
            <div class="setup-group"><label>í™˜ì˜ ë¬¸êµ¬</label><input type="text" id="set-welcome" placeholder="ì˜ˆ: ì‚¬ë‘í•´ ì—„ë§ˆ!"></div>
            <div class="setup-group"><label>ì¸ì¶œ í•­ëª©</label><input type="text" id="set-coupon" placeholder="ì˜ˆ: íš¨ë„ ìš©ëˆ 100ë§Œì›"></div>
            <div class="setup-group"><label>ë°ì´í„°(URL/ì½”ë“œ)</label><input type="text" id="set-data" placeholder="ì˜ˆ: LOVE-2024"></div>
            <div class="setup-group"><label>í•˜ë‹¨ ë©˜íŠ¸</label><input type="text" id="set-bottom" placeholder="ì˜ˆ: í•­ìƒ ê°ì‚¬í•©ë‹ˆë‹¤"></div>
            <div style="display:flex; gap:5px;" class="setup-group">
                <div style="flex:1;"><label>íƒ€ì…</label><select id="set-type"><option value="barcode">ë°”ì½”ë“œ</option><option value="qr">QR</option></select></div>
                <div style="flex:1;"><label>ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="set-pw-val" placeholder="4ìë¦¬(ì„ íƒ)"></div>
            </div>
            <button class="primary-btn" onclick="startSystem()">ATM ì‹œìŠ¤í…œ ì‹œì‘</button>
            <p style="font-size: 0.65rem; color: red; text-align: center;">* ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì•ˆë‚´ ìŒì„±ì´ í™œì„±í™”ë©ë‹ˆë‹¤.</p>
        </div>

        <div id="screen-main" class="screen">
            <div class="header">ğŸ¦ í–‰ë³µì€í–‰ (Happiness Bank)</div>
            <div style="text-align: center; flex: 1; display: flex; flex-direction: column; justify-content: center;">
                <h3 id="view-target" style="font-size: 1.5rem;">ê³ ê°ë‹˜</h3>
                <p id="view-welcome" style="color: #666;">í™˜ì˜í•©ë‹ˆë‹¤.</p>
                <button class="withdraw-btn" onclick="goToPassword()">ì¸ì¶œí•˜ê¸°</button>
                <p style="font-size: 0.8rem; color: var(--main-blue);">ë²„íŠ¼ì„ ëˆŒëŸ¬ ê±°ë˜ë¥¼ ì‹œì‘í•˜ì‹­ì‹œì˜¤</p>
            </div>
        </div>

        <div id="screen-pw" class="screen">
            <div class="header">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</div>
            <div style="text-align: center; flex:1; display:flex; flex-direction:column; justify-content:center;">
                <div class="pw-display" id="pw-dots"></div>
                <div class="keypad">
                    <script>for(let i=1; i<=9; i++) document.write(`<div class="key" onclick="pressKey('${i}')">${i}</div>`);</script>
                    <div class="key" style="visibility:hidden"></div><div class="key" onclick="pressKey('0')">0</div><div class="key" onclick="resetPw()" style="color:red; font-size:1rem;">ì •ì •</div>
                </div>
            </div>
        </div>

        <div id="screen-loading" class="screen">
            <div style="text-align: center; flex: 1; display: flex; flex-direction: column; justify-content: center;">
                <div class="loading-wheel"></div>
                <h3>í–‰ë³µì„ ì¸ì¶œ ì¤‘ì…ë‹ˆë‹¤...</h3>
            </div>
        </div>

        <div id="screen-result" class="screen">
            <div class="header">ê±°ë˜ ì™„ë£Œ</div>
            <div id="receipt-capture">
                <div id="receipt-area">
                    <div style="text-align:center; font-weight:bold; border-bottom:2px solid #333; margin-bottom:10px; padding-bottom:5px;">[ í–‰ë³µì€í–‰ ëª…ì„¸í‘œ ]</div>
                    <p>ê±°ë˜ì¼ì‹œ: <span id="res-date"></span></p>
                    <p>ì¸ì¶œí•­ëª©: <strong id="res-coupon"></strong></p>
                    <p>ìˆ˜ ë ¹ ì¸: <strong id="res-target"></strong></p>
                    <div id="qrcode" style="display:none;"></div>
                    <div id="barcode" class="barcode" style="display:none;"></div>
                    <div id="res-code-text" style="text-align:center; font-family:monospace; font-weight:bold;"></div>
                    <p id="res-bottom" style="margin-top:15px; text-align:center; color:var(--main-blue); font-weight:bold;"></p>
                </div>
            </div>
            <button class="primary-btn" onclick="downloadReceipt()" style="background:var(--gold);">ëª…ì„¸í‘œ ì´ë¯¸ì§€ ì €ì¥</button>
            <button class="primary-btn" onclick="location.reload()" style="background:#555;">ì²˜ìŒìœ¼ë¡œ</button>
        </div>
    </div>

    <script>
        // TTS í•¨ìˆ˜
        function speak(text) {
            window.speechSynthesis.cancel(); // ì´ì „ ìŒì„± ì·¨ì†Œ
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'ko-KR';
            msg.rate = 1.0;
            window.speechSynthesis.speak(msg);
        }

        function startSystem() {
            if(!document.getElementById('set-target').value) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");
            speak("í–‰ë³µì€í–‰ ATM ì‹œìŠ¤í…œì„ ì‹œì‘í•©ë‹ˆë‹¤. ì¸ì¶œí•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
            document.getElementById('view-target').innerText = document.getElementById('set-target').value + " ë‹˜";
            document.getElementById('view-welcome').innerText = document.getElementById('set-welcome').value;
            showScreen('screen-main');
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function goToPassword() {
            speak("ë³´ì•ˆì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•´ ì£¼ì‹­ì‹œì˜¤.");
            showScreen('screen-pw');
        }

        let pwInput = "";
        function pressKey(n) {
            if(pwInput.length < 4) {
                pwInput += n;
                document.getElementById('pw-dots').innerText = "* ".repeat(pwInput.length);
            }
            if(pwInput.length === 4) {
                const correct = document.getElementById('set-pw-val').value;
                if(correct && pwInput !== correct) {
                    speak("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    resetPw();
                } else {
                    speak("í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì‹­ì‹œì˜¤.");
                    setTimeout(process, 500);
                }
            }
        }

        function resetPw() { pwInput = ""; document.getElementById('pw-dots').innerText = ""; }

        function process() {
            showScreen('screen-loading');
            const data = document.getElementById('set-data').value || "HAPPY-GIFT";
            document.getElementById('res-date').innerText = new Date().toLocaleString();
            document.getElementById('res-target').innerText = document.getElementById('set-target').value;
            document.getElementById('res-coupon').innerText = document.getElementById('set-coupon').value;
            document.getElementById('res-bottom').innerText = document.getElementById('set-bottom').value;
            document.getElementById('res-code-text').innerText = data;

            if(document.getElementById('set-type').value === 'qr') {
                document.getElementById('qrcode').style.display = 'flex';
                document.getElementById('qrcode').innerHTML = "";
                new QRCode(document.getElementById("qrcode"), { text: data, width: 130, height: 130 });
            } else {
                document.getElementById('barcode').style.display = 'block';
            }

            setTimeout(() => {
                speak("ê±°ë˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ë‹¨ì˜ ëª…ì„¸í‘œë¥¼ í™•ì¸í•´ ì£¼ì‹­ì‹œì˜¤.");
                showScreen('screen-result');
            }, 3000);
        }

        // ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥
        function downloadReceipt() {
            const area = document.getElementById('receipt-capture');
            html2canvas(area).then(canvas => {
                const link = document.createElement('a');
                link.download = 'í–‰ë³µì€í–‰_ëª…ì„¸í‘œ.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
</body>
</html>
