<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HAPPY BANK 9.0 - Pro</title>
    <style>
        :root { --primary: #0054FF; --bg: #F0F3F7; --card: #FFFFFF; --accent: #FF3B30; --gold: #FFD700; }
        body, html { margin: 0; padding: 0; background: var(--bg); font-family: 'Pretendard', sans-serif; color: #333; }
        .app { max-width: 500px; margin: 0 auto; min-height: 100vh; position: relative; }
        .screen { display: none; padding: 20px; padding-bottom: 140px; }
        .screen.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: var(--card); border-radius: 24px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .btn { width: 100%; padding: 16px; border-radius: 16px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: #E8F0FF; color: var(--primary); }
        .input-box { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid #E5E8EB; border-radius: 12px; box-sizing: border-box; outline: none; }
        
        /* ë¡œë˜/ëª…ì„¸í‘œ ìŠ¤íƒ€ì¼ */
        .lotto-ball { display: inline-block; width: 35px; height: 35px; border-radius: 50%; background: var(--gold); color: #000; text-align: center; line-height: 35px; margin: 3px; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .receipt { background: white; padding: 20px; border: 1px dashed #ccc; font-family: monospace; position: relative; }
        .receipt::after { content: ''; position: absolute; left: 0; bottom: -10px; width: 100%; height: 10px; background-image: linear-gradient(-45deg, transparent 5px, white 5px), linear-gradient(45deg, transparent 5px, white 5px); background-size: 10px 10px; }
        
        #ad-layer { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #ddd; padding: 15px 0; text-align: center; z-index: 9999; }
    </style>
</head>
<body>

<div class="app">
    <div id="scr-main" class="screen active">
        <h2 style="color: var(--primary); display: flex; justify-content: space-between;">
            HAPPY BANK <span>ğŸ’</span>
        </h2>
        <div class="card" style="background: linear-gradient(135deg, #0054FF, #00C2FF); color: white;">
            <p style="margin:0; opacity:0.8;">ì‚¬ìš© ê°€ëŠ¥í•œ í¬ì¸íŠ¸</p>
            <h1 id="main-p" style="font-size: 36px; margin: 10px 0;">0 P</h1>
            <small id="user-tier">í‹°ì–´ ë¶„ì„ ì¤‘...</small>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button class="btn btn-secondary" onclick="move('inventory')">ğŸ“¦ ìì‚° ë“±ë¡</button>
            <button class="btn btn-secondary" onclick="move('lotto')">ğŸ° ë¡œë˜ ì¶”ì²œ</button>
        </div>
        <button class="btn btn-primary" style="margin-top:10px;" onclick="move('receive')">ğŸ“¥ ì„ ë¬¼ ì½”ë“œ/QR ë“±ë¡</button>
        
        <h3 style="margin-top:25px;">ë³´ìœ  ìì‚° ëª©ë¡</h3>
        <div id="quick-assets"></div>
    </div>

    <div id="scr-inventory" class="screen">
        <h3>ìì‚°/ë§í¬ ë“±ë¡</h3>
        <div class="card">
            <input type="text" id="new-name" class="input-box" placeholder="ìƒí’ˆëª… (ì˜ˆ: ìŠ¤íƒ€ë²…ìŠ¤)">
            <input type="text" id="new-link" class="input-box" placeholder="ë§í¬ ì£¼ì†Œ (URL) ë˜ëŠ” ì¿ í°ë²ˆí˜¸">
            <p style="font-size:12px; color:#666;">* ë§í¬ë¥¼ ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ QRì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
            <button class="btn btn-primary" onclick="addAsset()">ìì‚° ë“±ë¡ (100P ì†Œëª¨)</button>
        </div>
        <button class="btn" onclick="goBack()">ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="scr-lotto" class="screen">
        <h3>í–‰ìš´ì˜ ë¡œë˜ ë²ˆí˜¸</h3>
        <div class="card" style="text-align: center;">
            <p>500Pë¥¼ ì‚¬ìš©í•˜ì—¬ ë²ˆí˜¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
            <div id="lotto-res" style="margin: 20px 0;"></div>
            <button class="btn btn-primary" onclick="generateLotto()">ë²ˆí˜¸ ìƒì„±í•˜ê¸°</button>
        </div>
        <button class="btn" onclick="goBack()">ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="scr-gift" class="screen">
        <h3>ì„ ë¬¼ ëª…ì„¸í‘œ ë°œí–‰</h3>
        <div id="receipt-area" class="receipt card">
            <h2 style="text-align:center;">GIFT RECEIPT</h2>
            <hr>
            <p>í’ˆëª…: <span id="r-name"></span></p>
            <p>ë©”ì‹œì§€: <span id="r-msg"></span></p>
            <div id="qr-area" style="text-align:center; margin:15px 0;"></div>
            <p style="font-size:10px; word-break:break-all;">CODE: <span id="r-code"></span></p>
            <hr>
            <p style="text-align:center; font-size:12px;">THANK YOU!</p>
        </div>
        <button class="btn btn-primary" onclick="copyReceipt()">ëª…ì„¸í‘œ ì½”ë“œ ë³µì‚¬</button>
        <button class="btn" onclick="goBack()">ì™„ë£Œ</button>
    </div>

    <div id="scr-receive" class="screen">
        <h3>ì„ ë¬¼ ë°›ê¸°</h3>
        <div class="card">
            <input type="text" id="claim-code" class="input-box" placeholder="ë³µì‚¬í•œ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <button class="btn btn-primary" onclick="claimGift()">ìì‚° ë“±ë¡í•˜ê¸°</button>
        </div>
        <button class="btn" onclick="goBack()">ëŒì•„ê°€ê¸°</button>
    </div>
</div>

<div id="ad-layer">
    <div id="ad-timer" style="font-size:11px; color:red; margin-bottom:5px;"></div>
    <button id="ad-btn" class="btn" style="width:auto; padding:8px 20px; background:var(--gold); display:inline-block;" onclick="watchAd()">ğŸ“º ê´‘ê³  ë³´ê³  í¬ì¸íŠ¸ ë°›ê¸°</button>
    <div style="display:flex; justify-content:center; margin-top:10px;">
        <iframe data-aa='2425929' src='//acceptable.a-ads.com/2425929/?size=Adaptive' style='border:0; padding:0; width:320px; height:50px; overflow:hidden;'></iframe>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('happy_bank_v9')) || { p: 1000, assets: [] };
    let isAdWatching = false;

    function save() { 
        localStorage.setItem('happy_bank_v9', JSON.stringify(db)); 
        render(); 
    }

    function render() {
        document.getElementById('main-p').innerText = Math.floor(db.p).toLocaleString() + " P";
        const qa = document.getElementById('quick-assets');
        qa.innerHTML = db.assets.length ? "" : "<p style='text-align:center; color:#999;'>ë³´ìœ í•œ ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        db.assets.forEach((a, i) => {
            qa.innerHTML += `
                <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                    <div><b>${a.name}</b><br><small>${a.val.substring(0,15)}...</small></div>
                    <button class="btn btn-primary" style="width:auto; padding:8px 15px;" onclick="issueGift(${i})">ì„ ë¬¼</button>
                </div>`;
        });
    }

    // 1. ê´‘ê³  ì–´ë·°ì§• ë°©ì§€ (ì‹¤ì œ ëŒ€ê¸° ì‹œê°„ í•„ìš”)
    function watchAd() {
        if(isAdWatching) return;
        isAdWatching = true;
        let count = 5;
        const btn = document.getElementById('ad-btn');
        const timer = document.getElementById('ad-timer');
        
        const interval = setInterval(() => {
            btn.innerText = `ì‹œì²­ ì¤‘... (${count}s)`;
            count--;
            if(count < 0) {
                clearInterval(interval);
                db.p += 1000;
                save();
                btn.innerText = "ğŸ“º ê´‘ê³  ë³´ê³  í¬ì¸íŠ¸ ë°›ê¸°";
                timer.innerText = "1,000P ì ë¦½ ì™„ë£Œ!";
                isAdWatching = false;
                alert("í¬ì¸íŠ¸ê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!");
            }
        }, 1000);
    }

    // 2. ìì‚° ë° ë§í¬ ë“±ë¡ (QR ëŒ€ì‘)
    function addAsset() {
        const name = document.getElementById('new-name').value;
        const val = document.getElementById('new-link').value;
        if(!name || !val) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
        if(db.p < 100) return alert("í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");

        db.p -= 100;
        db.assets.push({ name, val });
        save();
        alert("ë“±ë¡ ì™„ë£Œ!");
        goBack();
    }

    // 3. ë¡œë˜ ë²ˆí˜¸ ìƒì„±
    function generateLotto() {
        if(db.p < 500) return alert("500Pê°€ í•„ìš”í•©ë‹ˆë‹¤.");
        db.p -= 500;
        
        let nums = [];
        while(nums.length < 6) {
            let r = Math.floor(Math.random() * 45) + 1;
            if(!nums.includes(r)) nums.push(r);
        }
        nums.sort((a,b) => a-b);
        
        const resDiv = document.getElementById('lotto-res');
        resDiv.innerHTML = nums.map(n => `<span class="lotto-ball">${n}</span>`).join('');
        save();
    }

    // 4. ëª…ì„¸í‘œ ì¸ì¶œ ë° QR ìƒì„±
    function issueGift(idx) {
        const asset = db.assets[idx];
        const msg = prompt("ì¹œêµ¬ì—ê²Œ ë³´ë‚¼ ë©”ì‹œì§€:");
        
        document.getElementById('r-name').innerText = asset.name;
        document.getElementById('r-msg').innerText = msg || "ì„ ë¬¼ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤!";
        
        // QR API í™œìš© (ë§í¬ì¸ ê²½ìš°)
        const qrArea = document.getElementById('qr-area');
        if(asset.val.includes('http')) {
            qrArea.innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(asset.val)}" alt="QR">`;
        } else {
            qrArea.innerHTML = "<b>[ë°”ì½”ë“œ/ì½”ë“œ í˜•íƒœ]</b>";
        }

        const giftData = btoa(unescape(encodeURIComponent(JSON.stringify({
            n: asset.name, v: asset.val, m: msg, ver: "9.0"
        }))));
        document.getElementById('r-code').innerText = giftData;
        
        db.assets.splice(idx, 1); // ì¸ì¶œ ì²˜ë¦¬
        save();
        move('gift');
    }

    // 5. ì„ ë¬¼ ë°›ê¸° (ì½”ë“œ í•´ì„)
    function claimGift() {
        const code = document.getElementById('claim-code').value;
        try {
            const data = JSON.parse(decodeURIComponent(escape(atob(code))));
            db.assets.push({ name: data.n, val: data.v });
            save();
            alert(`[${data.n}] ìì‚°ì´ ë³´ê´€í•¨ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\në©”ì‹œì§€: ${data.m}`);
            goBack();
        } catch(e) { alert("ì˜ëª»ëœ ëª…ì„¸í‘œ ì½”ë“œì…ë‹ˆë‹¤."); }
    }

    // ê³µí†µ í•¨ìˆ˜
    function move(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('scr-'+id).classList.add('active');
    }
    function goBack() { move('main'); }
    function copyReceipt() {
        const code = document.getElementById('r-code').innerText;
        navigator.clipboard.writeText(code).then(() => alert("ëª…ì„¸í‘œ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì¹œêµ¬ì—ê²Œ ì „ë‹¬í•˜ì„¸ìš”!"));
    }

    render();
</script>
</body>
</html>
