<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HAPPY GIFT BANK</title>
    <style>
        :root { --primary: #0054FF; --bg: #F4F6FA; --card: #FFFFFF; --text: #1A1F27; }
        body, html { margin: 0; padding: 0; background: var(--bg); font-family: sans-serif; overflow-x: hidden; }
        .screen { display: none; padding: 20px; box-sizing: border-box; min-height: 100vh; padding-bottom: 120px; }
        .screen.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: var(--card); border-radius: 20px; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .btn { width: 100%; padding: 15px; border-radius: 15px; border: none; font-weight: bold; cursor: pointer; margin-bottom: 10px; font-size: 16px; }
        .btn-main { background: var(--primary); color: white; }
        .input-box { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .asset-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 10px 0; }
        #ad-bottom { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #ddd; padding: 10px 0; text-align: center; z-index: 1000; }
    </style>
</head>
<body onclick="initAudio()">

<div id="app">
    <div id="scr-main" class="screen active">
        <h2 style="color: var(--primary);">ğŸ MY GIFT BANK</h2>
        <div class="card" style="background: linear-gradient(135deg, #0054FF, #6699FF); color: white;">
            <p style="margin:0; opacity:0.8;">ë³´ìœ  í¬ì¸íŠ¸ (ìˆ˜ìˆ˜ë£Œìš©)</p>
            <h1 id="main-p">0 P</h1>
        </div>
        
        <button class="btn btn-main" onclick="move('inventory')">ğŸ“¦ ë‚´ ìì‚° ë³´ê´€í•¨</button>
        <button class="btn" style="background: #E8F0FF; color: var(--primary);" onclick="move('receive')">ğŸ“¥ ì„ ë¬¼ ì½”ë“œ ë“±ë¡</button>
        
        <h3 style="margin-top:25px;">ë¹ ë¥¸ ì„ ë¬¼í•˜ê¸°</h3>
        <div id="quick-assets"></div>
    </div>

    <div id="scr-inventory" class="screen">
        <h3>ìì‚° ë“±ë¡í•˜ê¸°</h3>
        <div class="card">
            <input type="text" id="new-asset-name" class="input-box" placeholder="ìì‚° ì´ë¦„ (ì˜ˆ: ì»¤í”¼ ì¿ í°)">
            <input type="text" id="new-asset-val" class="input-box" placeholder="ìƒì„¸ ë‚´ìš© (í•€ë²ˆí˜¸ ë˜ëŠ” ë©”ì‹œì§€)">
            <button class="btn btn-main" onclick="addAsset()">ë‚´ ìì‚°ìœ¼ë¡œ ë“±ë¡ (+100P í•„ìš”)</button>
        </div>
        <h3>ë³´ìœ  ì¤‘ì¸ ìì‚° ëª©ë¡</h3>
        <div id="asset-list" class="card"></div>
        <button class="btn" onclick="goBack()">ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="scr-gift" class="screen">
        <h3>ì„ ë¬¼ ëª…ì„¸í‘œ ë°œí–‰</h3>
        <div class="card">
            <p id="gift-target-name" style="font-weight:bold; color:var(--primary);"></p>
            <textarea id="gift-msg" class="input-box" placeholder="ì¹œêµ¬ì—ê²Œ ë³´ë‚¼ ë”°ëœ»í•œ í•œë§ˆë””"></textarea>
            <p style="font-size:12px; color:red;">* ë°œí–‰ ì‹œ ë‚´ ëª©ë¡ì—ì„œ ìì‚°ì´ ì¦‰ì‹œ ì¸ì¶œë©ë‹ˆë‹¤.</p>
        </div>
        <button class="btn btn-main" onclick="generateGiftCode()">ì„ ë¬¼ ëª…ì„¸í‘œ ì½”ë“œ ìƒì„±</button>
        <div id="gift-code-res" class="card" style="display:none; background:#f9f9f9; word-break:break-all; font-family:monospace;"></div>
        <button class="btn" onclick="goBack()">ì·¨ì†Œ</button>
    </div>

    <div id="scr-receive" class="screen">
        <h3>ì„ ë¬¼ ë°›ê¸°</h3>
        <div class="card">
            <input type="text" id="inbox-code" class="input-box" placeholder="ì „ë‹¬ë°›ì€ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <button class="btn btn-main" onclick="claimGift()">ìì‚° ë³´ê´€í•¨ì— ì¶”ê°€</button>
        <button class="btn" onclick="goBack()">ë’¤ë¡œê°€ê¸°</button>
    </div>
</div>

<div id="ad-bottom">
    <button onclick="adReward()" style="background: #FFD700; border:none; padding:5px 15px; border-radius:20px; font-weight:bold; margin-bottom:5px; cursor:pointer;">âš¡ ê´‘ê³  ë³´ê³  500P ì¶©ì „</button>
    <div style="display:flex; justify-content:center;">
        <iframe data-aa='2425929' src='//acceptable.a-ads.com/2425929/?size=Adaptive' style='border:0; padding:0; width:320px; height:50px; overflow:hidden;'></iframe>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('gift_bank_db')) || {
        p: 500,
        assets: [] // {id, name, val}
    };

    function save() { localStorage.setItem('gift_bank_db', JSON.stringify(db)); render(); }

    function render() {
        document.getElementById('main-p').innerText = db.p.toLocaleString() + " P";
        
        // ë©”ì¸ í€µ ìì‚°
        const qa = document.getElementById('quick-assets');
        qa.innerHTML = db.assets.length ? "" : "<p style='color:#999;'>ë“±ë¡ëœ ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        db.assets.forEach((a, i) => {
            qa.innerHTML += `<div class="card" onclick="prepareGift(${i})"><b>${a.name}</b><br><small style="color:var(--primary);">ì„ ë¬¼í•˜ê¸° (ì¸ì¶œ) ></small></div>`;
        });

        // ì¸ë²¤í† ë¦¬ ëª©ë¡
        const al = document.getElementById('asset-list');
        al.innerHTML = db.assets.map((a, i) => `
            <div class="asset-item">
                <span>${a.name}</span>
                <button onclick="removeAsset(${i})" style="color:red; border:none; background:none;">ì‚­ì œ</button>
            </div>
        `).join('');
    }

    // ìì‚° ë“±ë¡
    function addAsset() {
        const name = document.getElementById('new-asset-name').value;
        const val = document.getElementById('new-asset-val').value;
        if(!name || !val) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        if(db.p < 100) return alert("ë“±ë¡ ìˆ˜ìˆ˜ë£Œ 100Pê°€ í•„ìš”í•©ë‹ˆë‹¤. ê´‘ê³ ë¥¼ ë´ì£¼ì„¸ìš”!");

        db.p -= 100;
        db.assets.push({ id: Date.now(), name, val });
        document.getElementById('new-asset-name').value = "";
        document.getElementById('new-asset-val').value = "";
        save();
        alert("ìì‚°ì´ ì•ˆì „í•˜ê²Œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    // ì„ ë¬¼í•˜ê¸° ì¤€ë¹„
    let selectedAssetIdx = -1;
    function prepareGift(i) {
        selectedAssetIdx = i;
        document.getElementById('gift-target-name').innerText = `[${db.assets[i].name}] ì„ ë¬¼í•˜ê¸°`;
        document.getElementById('gift-code-res').style.display = 'none';
        move('gift');
    }

    // ëª…ì„¸í‘œ ì½”ë“œ ìƒì„± (ì¸ì¶œ)
    function generateGiftCode() {
        const asset = db.assets[selectedAssetIdx];
        const msg = document.getElementById('gift-msg').value;
        
        const giftObj = {
            type: "HAPPY_GIFT_V2",
            name: asset.name,
            val: asset.val,
            msg: msg,
            salt: Math.random().toString(36).substr(2, 5)
        };

        const code = btoa(unescape(encodeURIComponent(JSON.stringify(giftObj))));
        
        // ì¸ì¶œ ì²˜ë¦¬
        db.assets.splice(selectedAssetIdx, 1);
        save();

        const res = document.getElementById('gift-code-res');
        res.style.display = 'block';
        res.innerText = code;
        
        alert("ëª…ì„¸í‘œ ì½”ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ ì „ë‹¬í•˜ì„¸ìš”.");
        speak("ì„ ë¬¼ ëª…ì„¸í‘œ ì¸ì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    // ì„ ë¬¼ ë°›ê¸°
    function claimGift() {
        const code = document.getElementById('inbox-code').value;
        try {
            const data = JSON.parse(decodeURIComponent(escape(atob(code))));
            if(data.type !== "HAPPY_GIFT_V2") throw new Error();

            db.assets.push({ id: Date.now(), name: data.name, val: data.val });
            document.getElementById('inbox-code').value = "";
            save();
            alert(`ğŸ [${data.name}] ì„ ë¬¼ì´ ë³´ê´€í•¨ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤!\në©”ì‹œì§€: ${data.msg}`);
            move('main');
        } catch(e) {
            alert("ìœ íš¨í•˜ì§€ ì•Šì€ ì„ ë¬¼ ì½”ë“œì…ë‹ˆë‹¤.");
        }
    }

    // ìœ í‹¸ë¦¬í‹°
    function move(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('scr-'+id).classList.add('active');
    }
    function goBack() { move('main'); }
    function adReward() { db.p += 500; save(); speak("ì˜¤ë°± í¬ì¸íŠ¸ ì¶©ì „ ì™„ë£Œ!"); }
    function removeAsset(i) { if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { db.assets.splice(i,1); save(); } }
    function initAudio() { /* TTSìš© */ }
    function speak(t) { window.speechSynthesis.cancel(); const m = new SpeechSynthesisUtterance(t); m.lang='ko-KR'; window.speechSynthesis.speak(m); }

    render();
</script>
</body>
</html>
